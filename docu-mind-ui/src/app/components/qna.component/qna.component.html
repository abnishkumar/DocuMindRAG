<div class="container my-5">
    <div class="col-12">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h2><i class="fas fa-question-circle me-2"></i>Q&A Community</h2>
            <button 
              class="btn btn-primary btn-custom"
              data-bs-toggle="modal"
              data-bs-target="#newQuestionModal">
              <i class="fas fa-plus me-2"></i>Ask Question
            </button>
          </div>
    </div>
    <div class="card shadow-lg p-4">
        <div class="jumbotron text-white rounded p-5 mb-4">
            @if (loading) {
            <div class="alert alert-info text-center" role="alert">
                <div class="spinner-border spinner-border-sm me-2" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                Processing your question...
            </div>
            }
            @if (error) {
            <div class="alert alert-danger" role="alert">
                {{ error }}
                <button class="btn btn-outline-primary btn-sm ms-3" (click)="retryLastQuestion()">
                    Retry
                </button>
            </div>
            }
            @if (messages.length > 0) {
            <div class="chat-messages">
                @for (message of messages; track message.id) {
                <div class="message" [ngClass]="message.isUser ? 'message-user' : 'message-ai'">
                    <div class="message-content">
                        <div class="message-header">
                            <strong>{{ message.isUser ? 'You' : 'AI' }}</strong>
                            <span class="text-muted ms-2">{{ message.timestamp | date:'shortTime' }}</span>
                        </div>
                        <p>{{ message.text }}</p>
                    </div>
                </div>
                }
            </div>
            } @else if (!loading && !error) {
            <div class="alert alert-warning text-center" role="alert">
                Start the conversation by asking a question!
            </div>
            }
        </div>
        <form [formGroup]="chatForm" (ngSubmit)="sendQuestion()" class="chat-form">
            <div class="input-group">
                <input type="text" class="form-control" placeholder="Type your question..." formControlName="question"
                    [class.is-invalid]="chatForm.get('question')?.invalid && chatForm.get('question')?.touched">
                <button type="submit" class="btn btn-primary" [disabled]="chatForm.invalid || loading">
                    <i class="bi bi-send me-1"></i>Send
                </button>
            </div>
            @if(chatForm.get('question')?.invalid && chatForm.get('question')?.touched){
            <div class="invalid-feedback">
                Please enter a question.
            </div>
            }
        </form>
    </div>
</div>